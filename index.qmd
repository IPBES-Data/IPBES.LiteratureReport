---
title: "Bibliography Reports"
format:
    html:
        toc: true
        toc-depth: 2
        embed-resources: true
        code-fold: true
        code-summary: "Show the code"
params:
    bib_name: "IPBES.GA1"
---

# Introduction

```{r}
#| label: setup

library(knitr)

# Make sure that one sees the progress messages when rendering this document
knitr::opts_chunk$set(message = NA)

list.files(
  path = "R",
  pattern = "^[^z].*",
  full.names = TRUE
) |>
  lapply(
    source
  ) |>
  invisible()

```

This document is the starting page to the IPBES Bibliography Reports. Thes reports give information about the bibliographies from IPBES on Zotero.

## Methods

To compile the assessments, the following steps need to be done:

## Download the references from Zotero

```{r}
#| label: download_groups

c(
  # Assessments
  AFA = 2333070,
  AMA = 2333011,
  APA = 2333075,
  # BBA = ,
  ECA = 2345951,
  GA1 = 2333077,
  # GA2 = ,
  IAS = 2352922,
  LDR = 2333076,
  # MTA = ,
  # NXS = ,
  PPA = 2333088,
  SCM = 2333079,
  # SPC = ,
  # SUA = 2344805,
  # TCA = ,
  # VA = 2345372, # Still private

  # Others
  ILK = 2344322, # Indigenous and Local Kowlege
  IPCC = 2603670, # IPCC-IPBES
  # NFF = 4937409, # Nature Futures Framework NOT WORKING
  PAND = 2499181 # Pandemics
) |>
  update_groups()
```

## Calculate the bibliometric measures and the graphs for each report

```{r}
#| label: calculate_metrics_targets
#|
targets::tar_make(
  #  script = system.file(package = "IPBES.LiteratureReport", "_targets.R"
  reporter = "silent"
)
```

## Compile the reports

```{r}
#| label: make_reports
#|

make_reports()
```

## Reports

```{r}
#| label: reports_listing

reports <- list.files(
  path = "output",
  pattern = ".bibliography_report\\.html$",
  full.names = TRUE
)

name <- reports |>
  sub(pattern = "^[^_]*_([^_]*)_.*", replacement = "\\1")


id <- reports |>
  sub(pattern = ".*_(\\d*)\\..*", replacement = "\\1")
id <- paste0("https://zotero.org/groups/", id)

data.frame(
  "Zotero Library" = paste0('<a href="', id, '" target="_blank">', name, "</a>"),
  Report = paste0('<a href="', reports, '" target="_blank">', basename(reports), "</a>"),
  check.names = FALSE
) |>
  knitr::kable(
    format = "html",
    escape = FALSE,
    caption = "List of the reports"
  )

```
