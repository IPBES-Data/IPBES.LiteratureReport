---
title: "Bibliography Reports"
format:
    html:
        toc: true
        toc-depth: 2
        embed-resources: true
        code-fold: true
        code-summary: "Show the code"
params:
    bib_name: "IPBES.GA1"
---

# Introduction

```{r}
#| label: setup

library(knitr)

# Make sure that one sees the progress messages when rendering this document
knitr::opts_chunk$set(message = NA)

require("IPBES.LiteratureReport")

# This is only needed when the repo is cloned and the package is not installed, i.e. for debugging mostly
if (!isNamespaceLoaded("IPBES.LiteratureReport")) {
    # Here I assume that the command is run in a clone of the github repo
    if (!requireNamespace("devtools", quietly = TRUE)) {
        install.packages("devtools")
    }

    devtools::install_deps(dependencies = TRUE, upgrade = "never")

    devtools::load_all()
} 
```

This document is the starting page to the IPBES Bibliography Reports. Thes reports give information about the bibliographies from IPBES on Zotero.

## Methods

To compile the assessments, the following steps need to be done:

## Download the references from Zotero

```{r}
#| label: download_groups

c(
    # SPC = ,
    # GA2 = ,
    # MTA = ,
    # BBA = ,
    # NXS = ,
    # TCA = ,
    ILK = 2344322,
    IAS = 2352922,
    # SUA = 2344805,
    # VA = 2345372,
    GA1 = 2333077,
    LDR = 2333076,
    AFA = 2333070,
    AMA = 2333011,
    APA = 2333075,
    ECA = 2345951,
    PPA = 2333088,
    SCM = 2333079
) |>
    update_groups()
```

## Calculate the bibliometric measures and the graphs for each report

```{r}
#| label: calculate_metrics_targets

targets::tar_make(
    // script = system.file(package = "IPBES.LiteratureReport", "_targets.R")
)
```

## Compile the reports

```{r}
#| label: make_reports

file.copy(
    from = system.file(package = "IPBES.LiteratureReport", "bibliography_Report.qmd"),
    to = file.path(".", "bibliography_Report.qmd")
) |>
    invisible()

on.exit(unlink(file.path(".", "bibliography_Report.qmd")))

make_reports()
```

## Reports

```{r}
#| label: reports_listing

reports <- list.files(
    path = "output",
    pattern = "^IPBES\\..*\\.bibliography_report\\.html$",
    full.names = TRUE
)

data.frame(
    Report = paste0(
        '<a href="', reports, '">', basename(reports), '</a>'
    )
) |>
    knitr::kable(
        format = "html",
        escape = FALSE,
        caption = "List of the reports"
    )

```
